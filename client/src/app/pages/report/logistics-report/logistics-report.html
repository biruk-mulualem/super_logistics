<div id="dashboard_page">
  <div class="main">
    <app-header></app-header>
    <div class="content">

      <!-- Horizontal Panel -->
      <div class="report-panel-horizontal">
        <!-- Left Body: Table -->

        <div class="panel-body">
          <div class="table-container">
            <br>
            <h1 class="report-header">Logistics Report</h1>
            <!-- Table always visible -->
            <table id="reportTable" class="report-table">
              <thead>
                <tr>
                  <th>No</th>
                  <th>Item_Description</th>
                  <th>Container</th>
                  <th>UOM</th>
                  <th>Total Qty</th>
                  <th>Loaded Qty</th>
                  <th>Remaining Qty</th>

                  <th>Bill_No</th>
                    <th>Doc Owner</th>
                  <th>Truck/Air Waybill</th>
                  <th>DJ-Tranzit</th>
                  <th>Shipper</th>
                    <th>Doc Sent DJB</th>
                  <th>Doc Collected</th>
                  <th>Bill Collected</th>
                  <th>Origin</th>
                  <th>Loading date</th>

                  <!-- <th>Number of Container</th>
                  <th>Container Type</th> -->

                  <th>ETA DJB</th>
                  <th>DjbArrived</th>
                

                  <th>DJB Departed</th>

                  <th>Arrived To AAK</th>
                  <th>Arrived To SDT</th>
                
                  <th>Tax Paid</th>
                  <th>Container Returned</th>
                  <th>Remark</th>
                </tr>
              </thead>

              <tbody>
                <!-- Show placeholder row if there is no data -->
                <tr *ngIf="reportData.length === 0">
                  <td colspan="24"
                    style="text-align: left; color: #555353; font-style: italic; font-size: 20px;">
                    No shipments to display yet. Apply filters to load the data.
                  </td>
                </tr>

                <!-- Actual data rows -->
                <ng-container *ngFor="let t of reportData">
                  <tr *ngFor="let item of t.items; let i = index">
                    <!-- Transaction-level columns merged -->
                    <td *ngIf="i === 0" [attr.rowspan]="t.items.length">{{
                      t.transactionId }}</td>
                    <td>{{ item.itemDescription || '-' }}</td>
                    <td *ngIf="i === 0" [attr.rowspan]="t.items.length">
                      {{ (t.loadedOnfcl || 0) + ' Ã— ' + (t.containerType || '-')
                      }}
                    </td>
                    <td>{{ item.uom || '-' }}</td>
                    <td>{{ item.totalQnty || 0 }}</td>
                    <td>{{ item.loadedQnty || 0 }}</td>
                    <td>{{ item.remaningQnty || 0 }}</td>

                    <td *ngIf="i === 0" [attr.rowspan]="t.items.length">{{
                      t.billNo || '-' }}</td>
                         <td *ngIf="i === 0" [attr.rowspan]="t.items.length">{{
                      t.docOwner || '-' }}</td>
                    <td *ngIf="i === 0" [attr.rowspan]="t.items.length">{{
                      t.truckWayBill || '-' }}</td>
                    <td *ngIf="i === 0" [attr.rowspan]="t.items.length">{{
                      t.transitor || '-' }}</td>
                    <td *ngIf="i === 0" [attr.rowspan]="t.items.length">{{
                      t.shipper || '-' }}</td>
                            <td *ngIf="i === 0" [attr.rowspan]="t.items.length">{{
                      t.docSentDjb || '-' }}</td>
                    <td *ngIf="i === 0" [attr.rowspan]="t.items.length">{{
                      t.docCollected || '-' }}</td>
                    <td *ngIf="i === 0" [attr.rowspan]="t.items.length">{{
                      t.billCollected || '-' }}</td>
                    <td *ngIf="i === 0" [attr.rowspan]="t.items.length">{{
                      t.origin || '-' }}</td>
                    <!-- Item-specific columns -->

                    <td *ngIf="i === 0" [attr.rowspan]="t.items.length">
                      {{ t.loadingDate ? (t.loadingDate | date:'MMM d, y') : '-'
                      }}
                    </td>

                    <!-- <td *ngIf="i === 0" [attr.rowspan]="t.items.length">{{
                      t.loadedOnfcl || '-' }}</td>
                    <td *ngIf="i === 0" [attr.rowspan]="t.items.length">{{
                      t.containerType || '-' }}</td> -->

                    <td *ngIf="i === 0" [attr.rowspan]="t.items.length">{{
                      t.etadjb || '-' }}</td>
                    <td *ngIf="i === 0" [attr.rowspan]="t.items.length">{{
                      t.djbArrived || '-' }}</td>
                 

                    <!-- Event columns (merged) -->
                    <td *ngIf="i === 0" [attr.rowspan]="t.items.length"
                      style="white-space: pre-line">
                      {{ t.djbDepartedStack }}
                    </td>

                    <td *ngIf="i === 0" [attr.rowspan]="t.items.length"
                      style="white-space: pre-line">
                      {{ t.arrivedAAKStack }}
                    </td>
                    <td *ngIf="i === 0" [attr.rowspan]="t.items.length"
                      style="white-space: pre-line">
                      {{ t.arrivedSDTStack }}
                    </td>

                    <!-- Other transaction-level columns -->
              
                    <td *ngIf="i === 0" [attr.rowspan]="t.items.length">{{
                      t.taxPaid || '-' }}</td>
                    <td *ngIf="i === 0" [attr.rowspan]="t.items.length"
                      style="white-space: pre-line">
                      {{ t.containerReturnedStack }}
                    </td>
                    <td *ngIf="i === 0" [attr.rowspan]="t.items.length">{{
                      t.remark || '-' }}</td>
                  </tr>
                </ng-container>
              </tbody>
            </table>

          </div>
        </div>

        <!-- Right Filter Section -->
        <form autocomplete="off" novalidate (ngSubmit)="fetchAndPrint()">

          <div class="panel-filter">
            <br><br><br>
            <h2>Filter Logistics Report</h2>

            <!-- Row 1: Transaction ID & Bill No -->
            <div class="filter-row">
              <div class="filter-item">
                <label>Transaction ID</label>
                <input type="text" [(ngModel)]="filters.transactionId"
                  name="transactionId" placeholder="e.g. SDT000123" />
              </div>
              <div class="filter-item">
                <label>Bill No</label>
                <input type="text" [(ngModel)]="filters.billNo" name="billNo"
                  placeholder="Enter Bill Number" />
              </div>
            </div>

            <!-- Row 2: Shipper & Transitor -->
            <div class="filter-row">
              <div class="filter-item">
                <label>Shipper</label>
                <input type="text" [(ngModel)]="filters.shipper"
                  name="shipper"
                  placeholder="Enter Shipper Name" />
              </div>
              <div class="filter-item">
                <label>Transitor</label>
                <input type="text" [(ngModel)]="filters.transitor"
                  name="transitor" placeholder="Enter Transitor Name" />
              </div>
            </div>
            <!-- Row 3: Origin & Container Type -->
            <div class="filter-row">
              <div class="filter-item">
                <label>Origin</label>
                <select [(ngModel)]="filters.origin" name="origin">
                  <option value>All</option>
                  <option *ngFor="let origin of origins" [value]="origin">{{
                    origin }}</option>
                </select>
              </div>
              <div class="filter-item">
                <label>Container Type</label>
                <select [(ngModel)]="filters.containerType"
                  name="containerType">
                  <option value>All</option>
                  <option *ngFor="let type of containerTypes"
                    [value]="type">{{
                    type }}</option>
                </select>
              </div>
            </div>
            <!-- Row 4: Dates -->
            <div class="filter-row">
              <div class="filter-item">
                <label>ETA DJB (From)</label>
                <input type="date" [(ngModel)]="filters.etaStart"
                  name="etaStart" />
              </div>
              <div class="filter-item">
                <label>ETA DJB (To)</label>
                <input type="date" [(ngModel)]="filters.etaEnd"
                  name="etaEnd" />
              </div>
            </div>
            <!-- Row 5: Status & Document Owner -->
            <div class="filter-row">
              <div class="filter-item">
                <label>Status</label>
                <select [(ngModel)]="filters.status" name="status">
                  <option value="all_shipments">All Shipments</option>
                  <option value="recently_loaded_no_eta">Recently Loaded no
                    eta</option>
                  <option value="arrived_at_djb">Arrived at DJB</option>
                  <option value="not_arrived_at_djb">Not Arrived at DJB</option>
                  <option
                    value="dispatched_from_djb_but_not_arrived_aak">Dispatched
                    from DJB but not arrived aak</option>

                  <option value="arrived_at_aak">Arrived at AAK</option>
                  <option value="arrived_at_sdt">Arrived at SDT</option>

                  <option value="cancelled_loading">Cancelled Loading</option>
                  <option value="container_not_returned">Container Not
                    Returned</option>
                  <option value="tax_paid">Tax Paid</option>
                  <option value="tax_not_paid">Tax Not Paid</option>
                </select>
              </div>
              <div class="filter-item">
                <label>Document Owner</label>
                <input type="text" [(ngModel)]="filters.docOwner"
                  name="docOwner" placeholder="Enter Doc Owner Name" />
              </div>
            </div>
            <!-- Buttons -->
            <div class="filter-buttons">
              <button type="submit" class="print-btn">
                <i class="fas fa-filter"></i> Apply Filter
              </button>
              <button type="button" class="print-btn" (click)="printReport()">
                <i class="fas fa-print"></i> Print
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
    <app-sidebar></app-sidebar>
  </div>
</div>
