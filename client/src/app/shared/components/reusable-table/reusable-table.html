<div class="table-section">

  <div class="container">
    <input
      type="text"
      [(ngModel)]="searchQuery"
      (input)="onSearch()"
      class="search-input"
      placeholder="Search..." />


 

  <button
    *ngIf="buttonVisibility.add"
    class="add-btn"
    title="Add"
    (click)="openAddModal()">
    <i class="fas fa-plus"></i> 
  </button>


  </div>

  <!-- Table -->
  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th *ngFor="let header of headers">{{ header.label }}</th>
          <th *ngIf="hasAnyActionButton()">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let row of paginatedData">
          <td *ngFor="let header of headers" [attr.data-label]="header.label">
            {{ row[header.key] }}
          </td>
          <td *ngIf="hasAnyActionButton()" data-label="Actions">
            <div class="action-buttons">
              <button
                *ngIf="
                  buttonVisibility.detail ||
                  buttonVisibility.edit ||
                  buttonVisibility.payment ||
                  buttonVisibility.delete
                "
                class="detail-btn"
                (click)="openMainModal(row)">
                <i class="fas fa-eye"></i>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="pagination">
    <button
      class="page-btn"
      (click)="prevPage()"
      [disabled]="currentPage === 1">
      &lt;
    </button>
    <button
      class="page-btn"
      *ngFor="let page of [].constructor(totalPages); let i = index"
      [class.active]="currentPage === i + 1"
      (click)="setPage(i + 1)">
      {{ i + 1 }}
    </button>
    <button
      class="page-btn"
      (click)="nextPage()"
      [disabled]="currentPage === totalPages">
      &gt;
    </button>
  </div>
</div>


<!-- ================= ADD MODAL ================= -->
<div class="modal" *ngIf="showModal.add" (click)="closeModal('add')">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <!-- ================= ADD MODAL (Intransit) ================= -->
    <ng-container *ngIf="pageType === 'intransit'">
      <!-- Modal Header -->
      <div class="modal-header">
        <h3>Add New Purchase</h3>
      </div>
      <hr />

      <!-- Add Item Button -->
      <div
        class="modal-buttons"
        style="display: flex; gap: 10px; align-items: center">
        <button (click)="addRow('add')" class="btn btn-success add-btn">
          + Add Item
        </button>
      </div>

      <!-- Item Rows -->
      <div *ngFor="let item of addData.items; let i = index" class="item-row">
        <div class="modal-input-group">
          <label>Item Description</label>
          <input type="text" [(ngModel)]="item.itemDescription" />
        </div>

        <div class="modal-input-group">
          <label>UOM</label>
          <select [(ngModel)]="item.uom" required>
            <option *ngFor="let u of uoms" [value]="u">{{ u }}</option>
          </select>
        </div>

        <div class="modal-input-group">
          <label>Quantity</label>
          <input type="number" [(ngModel)]="item.quantity" />
        </div>

        <div class="modal-input-group">
          <label>Unit Price</label>
          <input type="number" [(ngModel)]="item.unitPrice" />
        </div>

        <div class="modal-input-group remove-btn">
          <button
            type="button"
            (click)="removeRow('add', i)"
            [disabled]="i === 0">
            X
          </button>
        </div>
      </div>

      <hr />

      <!-- Main Form Fields -->
      <div class="modal-form">
        <div class="modal-input-group">
          <label>Purchase Order</label>
          <input type="text" [(ngModel)]="addData.purchaseOrder" />
        </div>

        <div class="modal-input-group">
          <label>Purchase Date</label>
          <input type="date" [(ngModel)]="addData.purchaseDate" />
        </div>

        <div class="modal-input-group">
          <label>Origin</label>
          <select [(ngModel)]="addData.origin" required>
            <option *ngFor="let o of origins" [value]="o">
              {{ o | titlecase }}
            </option>
          </select>
        </div>

        <div class="modal-input-group">
          <label>Purchase Company</label>
          <input type="text" [(ngModel)]="addData.purchaseCompany" />
        </div>

        <div class="modal-input-group">
          <label>Contact Person</label>
          <input type="text" [(ngModel)]="addData.contactPerson" />
        </div>

        <div class="modal-input-group">
          <label>Remark</label>
          <textarea [(ngModel)]="addData.remark"></textarea>
        </div>
      </div>

      <hr />

      <!-- Modal Actions -->
      <div
        class="modal-buttons"
        style="margin-top: 10px; display: flex; gap: 10px">
        <button (click)="AddIntransitData()" class="btn btn-primary">
          Save
        </button>
        <button (click)="closeModal('add')" class="btn btn-secondary">
          Cancel
        </button>
      </div>
    </ng-container>
    <!-- ================= ADD MODAL (Logistics) ================= -->
    <ng-container *ngIf="pageType === 'logistics'">
      <!-- Modal Header -->
      <div class="modal-header">
        <h3>Add Logistics Entry</h3>
      </div>
      <hr />

      <!-- Add Item Button -->
      <div
        class="modal-buttons"
        style="display: flex; gap: 10px; align-items: center">
        <button (click)="addRow('logistics')" class="btn btn-success add-btn">
          + Add Item
        </button>
      </div>

      <!-- Item Rows -->
      <div *ngFor="let item of addData.items; let i = index" class="item-row">
        <!-- Transaction ID Selector -->
        <div class="modal-input-group">
          <label>Transaction ID</label>
          <select
            [(ngModel)]="item.transactionId"
            (ngModelChange)="onTransactionChange(item)">
            <option
              *ngFor="let trx of intransitOptions"
              [value]="trx.transactionId">
              {{ trx.transactionId }}
            </option>
          </select>
        </div>

        <!-- Item Description Selector -->
        <div class="modal-input-group">
          <label>Item Description</label>
          <select
            [(ngModel)]="item.selectedItem"
            (ngModelChange)="onItemChange(item)">
            <option *ngFor="let itm of item.availableItems" [ngValue]="itm">
              {{ itm.itemDescription }}
            </option>
          </select>
        </div>

        <!-- Auto-filled UOM -->
        <div class="modal-input-group">
          <label>UOM</label>
          <input type="text" [(ngModel)]="item.uom" readonly />
        </div>

        <!-- Editable Loaded Quantity -->
        <div class="modal-input-group">
          <label
            style="display: flex; justify-content: space-between; width: 100%">
            <span> Qnty</span>
            <span
              style="color: rgb(217, 24, 24); font-weight: normal">(Available:
              {{ item.quantity || 0 }})</span>
          </label>

          <input
            type="number"
            [value]="item.LoadedQnty"
            (input)="onLoadedQntyInput($event, item)"
            min="0" />
        </div>
        <!-- Remove Button -->
        <div class="modal-input-group remove-btn">
          <button type="button" (click)="removeRow('logistics', i)">X</button>
        </div>
      </div>
      <hr />
      <!-- Main Logistics Form -->
      <div class="modal-form">
        <div class="modal-input-group">
          <label>No-Cont</label>
          <input type="number" [(ngModel)]="addData.LoadedOnfcl" />
        </div>

        <div class="modal-input-group">
          <label>Cont-Type</label>
          <select [(ngModel)]="addData.containerType" required>
            <option *ngFor="let c of containerTypes" [value]="c">
              {{ c }}
            </option>
          </select>
        </div>

        <div class="modal-input-group">
          <label>Remark</label>
          <textarea [(ngModel)]="addData.remark"></textarea>
        </div>
      </div>
      <hr />
      <!-- Modal Actions -->
      <div
        class="modal-buttons"
        style="margin-top: 10px; display: flex; gap: 10px">
        <button (click)="saveAddLogsticsData()" class="btn btn-primary">
          Save
        </button>
        <button (click)="closeModal('add')" class="btn btn-secondary">
          Cancel
        </button>
      </div>
    </ng-container>
  </div>
</div>
<!-- ================= MAIN MODAL ================= -->
<div class="modal" *ngIf="showModal.main" (click)="closeModal('main')">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <!-- Modal Actions -->
    <div class="modal-actions">
      <h3 class="main-modal-title">
        {{ pageType === "intransit" ? "Intransit" : "Logistics" }} Main Modal
      </h3>

      <button
        class="btn-detail"
        *ngIf="buttonVisibility.detail"
        [class.active]="activeTab === 'detail'"
        (click)="setActiveTab('detail')">
        Detail
      </button>

      <button
        class="btn-edit"
        *ngIf="buttonVisibility.edit"
        [class.active]="activeTab === 'edit'"
        (click)="setActiveTab('edit')">
        Edit
      </button>

      <button
        class="btn-payment"
        *ngIf="buttonVisibility.payment"
        [class.active]="activeTab === 'payment'"
        (click)="setActiveTab('payment')">
        Payment
      </button>

      <button
        class="btn-delete"
        *ngIf="buttonVisibility.delete"
        [class.active]="activeTab === 'delete'"
        (click)="setActiveTab('delete')">
        Delete
      </button>
    </div>
    <hr />
    <!-- Modal Body -->
    <div class="main-modal-body">
      <!-- DETAIL TAB -->
      <ng-container *ngIf="activeTab === 'detail' && buttonVisibility.detail">
        <ng-container *ngIf="pageType === 'intransit' 
                  || pageType === 'doneintransithistory' 
                  || pageType === 'cancelledintransithistory'">

          <span>Product Detail</span>
          <div *ngIf="selectedRow?.items?.length; else noItems">
            <div *ngFor="let item of selectedRow.items" class="detail-row">
              <div class="detail-item">
                <span class="label">Item:</span>
                <span class="value">{{ item.itemDescription }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Quantity:</span>
                <span class="value">{{ item.quantity }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Uom:</span>
                <span class="value">{{ item.uom }}</span>
              </div>
              <div class="detail-item">
                <span class="label">U.Price:</span>
                <span class="value">{{ item.unitPrice }}</span>
              </div>
            </div>
          </div>
          <ng-template #noItems>
            <p>No product details available.</p>
          </ng-template>

          <span>Common Data</span>
          <div class="detail-row">
            <div class="detail-item">
              <span class="label">GRN:</span>
              <span class="value">{{ selectedRow?.grn }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Purchase Company:</span>
              <span class="value">{{ selectedRow?.purchaseCompany }}</span>
            </div>
          </div>
          <div class="detail-row">
            <div class="detail-item">
              <span class="label">Origin:</span>
              <span class="value">{{ selectedRow?.origin }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Contact Person:</span>
              <span class="value">{{ selectedRow?.contactPerson }}</span>
            </div>
          </div>
          <div class="detail-row">
            <div class="detail-item">
              <span class="label">Remark:</span>
              <span class="value">{{ selectedRow?.remark }}</span>
            </div>
          </div>

          <hr />
          <span>Payment History</span>
          <div *ngIf="paymentTerms?.length; else noPayments">
            <div *ngFor="let payment of paymentTerms" class="detail-row">
              <div class="detail-item">
                <span class="label">Date:</span>
                <span class="value">{{ payment.paidDate }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Amount:</span>
                <span class="value">{{ payment.amountPaid }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Paid By:</span>
                <span class="value">{{ payment.paidBy }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Account:</span>
                <span class="value">{{ payment.accountPaidFrom }}</span>
              </div>
            </div>
          </div>
          <ng-template #noPayments>
            <p>No payment records available.</p>
          </ng-template>
          <div class="modal-buttons">
            <button (click)="closeModal()" class="btn btn-secondary">
              Close
            </button>
          </div>
        </ng-container>

        <!-- <pre>Selected Row: {{ selectedRow | json }}</pre> -->
        <ng-container *ngIf="(pageType === 'logistics' 
          || pageType === 'donelogisticshistory' 
          || pageType === 'cancelledlogisticshistory')
         && selectedRow">
          <!-- Product Detail -->
          <span>Product Detail</span>
          <div *ngFor="let item of selectedRow.items">
            <div class="detail-row">
              <div class="detail-item">
                <span class="label">Item Description:</span>
                <span class="value">{{ item.itemDescription }}</span>
              </div>
              <div class="detail-item">
                <span class="label">UOM:</span>
                <span class="value">{{ item.uom }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Loaded Quantity:</span>
                <span class="value">{{ item.loadedQnty }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Remaining Quantity:</span>
                <span class="value">{{ item.remaningQnty }}</span>
              </div>
            </div>
          </div>

          <!-- Common Data -->
          <span>Common Data</span>
          <div class="detail-row">
            <div class="detail-item">
              <span class="label">ETADJB:</span>
              <span class="value">{{ selectedRow.etadjb }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Loading Date:</span>
              <span class="value">{{ selectedRow.loadingDate }}</span>
            </div>
            <div class="detail-item">
              <span class="label">DJB Arrived:</span>
              <span class="value">{{ selectedRow.djbArrived }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Doc Sent DJB:</span>
              <span class="value">{{ selectedRow.docSentDjb }}</span>
            </div>
          </div>

          <div class="detail-row">
            <div class="detail-item">
              <span class="label">Bill Collected:</span>
              <span class="value">{{ selectedRow.billCollected }}</span>
            </div>

            <div class="detail-item">
              <span class="label">Doc Collected:</span>
              <span class="value">{{ selectedRow.docCollected }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Tax Paid:</span>
              <span class="value">{{ selectedRow.taxPaid }}</span>
            </div>

            <div class="detail-item">
              <span class="label">Origin:</span>
              <span class="value">{{ selectedRow.origin }}</span>
            </div>
          </div>

          <hr />
          <!-- ================== Djibouti Departed ================== -->
          <div *ngIf="selectedRow?.djbDeparted?.length > 0">
            <h3>Djb Departed</h3>
            <div *ngFor="let row of selectedRow.djbDeparted" class="detail-row">
              <div class="detail-item">
                <span class="label">Date:</span>
                <span class="value">{{ row.date }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Number of Containers:</span>
                <span class="value">{{ row.numberOfContainer }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Remark:</span>
                <span class="value">{{ row.remark }}</span>
              </div>
            </div>
          </div>

          <hr />

          <!-- ================== AAK Arrived ================== -->

          <div *ngIf="selectedRow?.arrivedAAk?.length > 0">
            <h3>AAK Arrived</h3>
            <div *ngFor="let row of selectedRow.arrivedAAk" class="detail-row">
              <div class="detail-item">
                <span class="label">Date:</span>
                <span class="value">{{ row.date }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Number of Containers:</span>
                <span class="value">{{ row.numberOfContainer }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Remark:</span>
                <span class="value">{{ row.remark }}</span>
              </div>
            </div>
          </div>

          <!-- ================== SDT Arrived ================== -->
          <div *ngIf="selectedRow?.arrivedSDT?.length > 0">
            <h3>SDT Arrived</h3>
            <div *ngFor="let row of selectedRow.arrivedSDT" class="detail-row">
              <div class="detail-item">
                <span class="label">Date:</span>
                <span class="value">{{ row.date | date : "mediumDate" }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Number of Containers:</span>
                <span class="value">{{ row.numberOfContainer }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Remark:</span>
                <span class="value">{{ row.remark }}</span>
              </div>
            </div>
          </div>

          <!-- ================== Containers Returned ================== -->
          <div *ngIf="selectedRow?.containerReturned?.length > 0">
            <h3>Empity Containers Returned</h3>
            <div
              *ngFor="let row of selectedRow.containerReturned"
              class="detail-row">
              <div class="detail-item">
                <span class="label">Date:</span>
                <span class="value">{{ row.date | date : "mediumDate" }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Number of Containers:</span>
                <span class="value">{{ row.numberOfContainer }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Remark:</span>
                <span class="value">{{ row.remark }}</span>
              </div>
            </div>
          </div>

          <div class="detail-row">
            <div class="detail-item">
              <span class="label">Remark:</span>
              <span class="value">{{ selectedRow.remark }}</span>
            </div>
          </div>

          <div class="modal-buttons">
            <button (click)="closeModal()" class="btn btn-secondary">
              Close
            </button>
          </div>
        </ng-container>
      </ng-container>
      <!-- EDIT TAB -->
      <ng-container *ngIf="activeTab === 'edit' && buttonVisibility.edit">
        <ng-container *ngIf="pageType === 'intransit'">
          <span>Product Detail</span>

          <div
            class="modal-buttons"
            style="display: flex; gap: 10px; align-items: center">
            <button
              (click)="addRow('editIntransitItem')"
              class="btn btn-success add-btn">
              + Add Item
            </button>
          </div>

          <div
            *ngFor="let item of editData.items; let i = index"
            class="detail-row">
            <div class="modal-form">
              <div class="modal-input-group">
                <label>Item:</label>
                <input
                  type="text"
                  [(ngModel)]="item.itemDescription"
                  required />
              </div>
            </div>
            <div class="modal-form">
              <div class="modal-input-group">
                <label>Quantity:</label>
                <input type="number" [(ngModel)]="item.quantity" required />
              </div>
            </div>
            <div class="modal-input-group">
              <label>UOM</label>
              <select [(ngModel)]="item.uom" required>
                <option *ngFor="let u of uoms" [value]="u">{{ u }}</option>
              </select>
            </div>

            <div class="modal-form">
              <div class="modal-input-group">
                <label>U.Price:</label>
                <input type="number" [(ngModel)]="item.unitPrice" required />
              </div>
            </div>

            <div class="modal-input-group remove-btn">
              <button
                type="button"
                (click)="removeRow('editIntransitItem', i)"
                style="width: 25px; margin-top: 10px">
                X
              </button>
            </div>
          </div>

          <hr />
          <span>Common Data</span>
          <div class="modal-form">
            <div class="modal-input-group">
              <label>Purchase Date:</label>
              <input type="date" [(ngModel)]="editData.purchaseDate" required />
            </div>
            <div class="modal-input-group">
              <label>Purchase Order:</label>
              <input
                type="text"
                [(ngModel)]="editData.purchaseOrder"
                required />
            </div>
            <div class="modal-input-group">
              <label>Purchase Company:</label>
              <input
                type="text"
                [(ngModel)]="editData.purchaseCompany"
                required />
            </div>
            <div class="modal-input-group">
              <label>Origin:</label>
              <select [(ngModel)]="editData.origin" required>
                <option *ngFor="let o of origins" [value]="o">
                  {{ o | titlecase }}
                </option>
              </select>
            </div>

            <div class="modal-input-group">
              <label>GRN:</label>
              <input type="text" [(ngModel)]="editData.grn" required />
            </div>
            <div class="modal-input-group">
              <label>Contact Person:</label>
              <input
                type="text"
                [(ngModel)]="editData.contactPerson"
                required />
            </div>
            <div class="modal-input-group full-width">
              <label>Remark:</label>
              <textarea [(ngModel)]="editData.remark"></textarea>
            </div>
          </div>

          <hr />
          <span>Payment Detail</span>

          <div
            class="modal-buttons"
            style="display: flex; gap: 10px; align-items: center">
            <button
              (click)="addRow('editIntransitPayment')"
              class="btn btn-success add-btn">
              + Add Payment
            </button>
          </div>
          <div
            *ngFor="let payment of editData.payments; let i = index"
            class="detail-row">
            <div class="modal-form">
              <div class="modal-input-group">
                <label>Amount Paid:</label>
                <input
                  type="number"
                  [(ngModel)]="payment.amountPaid"
                  required />
              </div>
            </div>
            <div class="modal-form">
              <div class="modal-input-group">
                <label>Paid By:</label>
                <input type="text" [(ngModel)]="payment.paidBy" required />
              </div>
            </div>
            <div class="modal-form">
              <div class="modal-input-group">
                <label>Account Paid From:</label>
                <input
                  type="text"
                  [(ngModel)]="payment.accountPaidFrom"
                  required />
              </div>
            </div>
            <div class="modal-form">
              <div class="modal-input-group">
                <label>Paid Date:</label>
                <input type="date" [(ngModel)]="payment.paidDate" required />
              </div>
            </div>

            <div class="modal-input-group remove-btn">
              <button
                type="button"
                (click)="removeRow('editIntransitPayment', i)"
                style="width: 25px; margin-top: 10px">
                X
              </button>
            </div>
          </div>

          <div class="modal-buttons">
            <button (click)="saveEditedIntransitData()" class="btn btn-primary">
              Save Changes
            </button>

            <button (click)="closeModal()" class="btn btn-secondary">
              Cancel
            </button>
          </div>
        </ng-container>

        <ng-container *ngIf="pageType === 'logistics'">

          <div class="combined-section"
            style="background-color: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);border: 1px solid #e0e0e0;">
            <span>Loading Details</span>

            <div
              *ngFor="let item of editData.items; let i = index"
              class="detail-row">
              <div class="modal-form">
                <div class="modal-input-group">
                  <label>Item Description:</label>
                  <input
                    type="text"
                    [(ngModel)]="item.itemDescription"
                    required readonly />
                </div>
              </div>

              <div class="modal-form">
                <div class="modal-input-group">
                  <label>UOM:</label>
                  <input type="text" [value]="item.uom" readonly />

                </div>
              </div>

              <div class="modal-form">
                <div class="modal-input-group">
                  <label>Loaded Quantity:</label>
                  <input type="number" [(ngModel)]="item.loadedQnty" required />
                </div>
              </div>

              <button type="button"
                (click)="removeItemFromLogisticsedit(i)">X</button>
            </div>

            <div class="modal-section">
              <!-- Labels aligned horizontally with background color -->
              <div class="header-row">
                <label class="header-label">Transaction ID</label>
                <label class="header-label">Item Description</label>
                <label class="header-label">UOM</label>
                <label class="header-label">Loaded Qnty</label>

                <!-- Button below the labels -->
                <div
                  class="modal-buttons"
                  style="display: flex; gap: 10px; align-items: center;">
                  <button (click)="addRow('logistics')"
                    class="btn btn-success add-btn">
                    + Add
                  </button>
                </div>

              </div>

              <div *ngFor="let item of addData.items; let i = index"
                class="item-row">
                <!-- Transaction ID Selector -->
                <div class="modal-input-group">

                  <select
                    [(ngModel)]="item.transactionId"
                    (ngModelChange)="onTransactionChange(item)">
                    <option
                      *ngFor="let trx of intransitOptions"
                      [value]="trx.transactionId">
                      {{ trx.transactionId }}
                    </option>
                  </select>
                </div>

                <div class="modal-input-group">

                  <input
                    type="text"
                    [(ngModel)]="item.transactionId"
                    (ngModelChange)="onTransactionChange(item)"
                    placeholder="Enter transaction ID " />
                </div>

                <!-- Item Description Selector -->
                <!-- <div class="modal-input-group">

                  <select
                    [(ngModel)]="item.selectedItem"
                    (ngModelChange)="onItemChange(item)">
                    <option *ngFor="let itm of item.availableItems"
                      [ngValue]="itm">
                      {{ itm.itemDescription }}
                    </option>
                  </select>
                </div> -->

                <!-- Auto-filled UOM -->
                <div class="modal-input-group">

                  <input type="text" [(ngModel)]="item.uom" readonly />
                </div>

                <!-- Editable Loaded Quantity -->
                <div class="modal-input-group">

                  <input
                    type="number"
                    [value]="item.LoadedQnty"
                    (input)="onLoadedQntyInput($event, item)"
                    min="0" placeholder="Available:{{item.quantity|| 0 }}" />
                </div>
                <!-- Remove Button -->

                <button type="button"
                  (click)="removeRow('logistics', i)">X</button>

              </div>
            </div>
          </div>
          <hr>

          <div class="combined-section"
            style="background-color: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);border: 1px solid #e0e0e0;">
            <span>Common Data</span>

            <div class="detail-row">
              <div class="modal-input-group">
                <label>Bill-No:</label>
                <input type="text" [(ngModel)]="editData.billNo" />
              </div>

              <div class="modal-input-group">
                <label>Track-Waybill:</label>
                <input type="text" [(ngModel)]="editData.truckWayBill" />
              </div>
              <div class="modal-input-group">
                <label>Shipper:</label>
                <input type="text" [(ngModel)]="editData.shipper" />
              </div>

              <div class="modal-input-group">
                <label>Transitor:</label>
                <input type="text" [(ngModel)]="editData.transitor" />
              </div>
              <div class="modal-input-group">
                <label>No-Cont:</label>
                <input type="text" [(ngModel)]="editData.loadedOnfcl" />
              </div>
            </div>

            <div class="detail-row">
              <div class="modal-input-group">
                <label>Loading Date:</label>
                <input type="date" [(ngModel)]="editData.loadingDate" />
              </div>

              <div class="modal-input-group">
                <label>Bill Collected:</label>
                <input type="date" [(ngModel)]="editData.billCollected" />
              </div>

              <div class="modal-input-group">
                <label>Origin:</label>
                <select [(ngModel)]="editData.origin">
                  <option *ngFor="let o of origins" [value]="o">{{ o }}</option>
                </select>
              </div>

              <div class="modal-input-group">
                <label>Doc-Owner:</label>
                <input type="text" [(ngModel)]="editData.docOwner" />
              </div>
              <div class="modal-input-group">
                <label>Cont-Type</label>
                <select [(ngModel)]="editData.containerType" required>
                  <option *ngFor="let c of containerTypes" [value]="c">
                    {{ c }}
                  </option>
                </select>
              </div>
            </div>
          </div>
          <hr>

          <div class="combined-section"
            style="background-color: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);border: 1px solid #e0e0e0;">
            <span>Djibouti status</span>
            <div class="detail-row">
              <div class="modal-input-group">
                <label>ETADJB:</label>
                <input type="date" [(ngModel)]="editData.etadjb" />
              </div>
              <div class="modal-input-group">
                <label>DJB Arrived:</label>
                <input type="date" [(ngModel)]="editData.djbArrived" />
              </div>
              <div class="modal-input-group">
                <label>Doc Sent DJB:</label>
                <input type="date" [(ngModel)]="editData.docSentDjb" />
              </div>
              <div class="modal-input-group">
                <label>Tax Paid:</label>
                <input type="date" [(ngModel)]="editData.taxPaid" />
              </div>

              <div class="modal-input-group">
                <label>Doc Collected:</label>
                <input type="date" [(ngModel)]="editData.docCollected" />
              </div>
            </div>

            <div class="modal-section">
              <!-- Labels aligned horizontally with background color -->
              <div class="header-row">
                <label class="header-label">Containers Dispatched Djb</label>
                <label class="header-label">Remark</label>
                <label class="header-label">Date</label>

                <!-- Button below the labels -->
                <div class="modal-buttons">
                  <button (click)="addRowDjbDeparted()"
                    class="btn btn-success add-btn">
                    + Add
                  </button>
                </div>
              </div>

              <div *ngFor="let row of rowDjbDeparted; let i = index"
                class="item-row">
                <div class="modal-input-group">
                  <input type="number" [(ngModel)]="row.numberOfContainer"
                    class="row-input input-number" style=" width: 200px;" />
                </div>

                <div class="modal-input-group">
                  <input type="text" [(ngModel)]="row.remark"
                    class="row-input input-remark" style=" width: 210px;" />
                </div>

                <div class="modal-input-group">
                  <input type="date" [(ngModel)]="row.date"
                    class="row-input input-date" style=" width: 210px;" />
                </div>

                <button type="button"
                  (click)="removeRowDjbDeparted(i)">X</button>

              </div>
            </div>
          </div>

          <hr />

          <div class="combined-section"
            style="background-color: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);border: 1px solid #e0e0e0;">
            <!-- ================== AAK Arrived ================== -->
            <span>AAk status</span>
            <div class="modal-section">
              <!-- <h3>Number of container AAK Arrived</h3> -->
              <div class="header-row">
                <label class="header-label">number of container</label>
                <label class="header-label">Remark</label>
                <label class="header-label">Date</label>
                <div class="modal-buttons">
                  <button (click)="addRowAakArrived()"
                    class="btn btn-success add-btn">
                    + add
                  </button>
                </div>
              </div>

              <!-- Dynamic rows -->
              <div *ngFor="let row of rowAakArrived; let i = index"
                class="item-row">
                <div class="modal-input-group">
                  <input type="number" [(ngModel)]="row.numberOfContainer"
                    class="row-input input-number" style=" width: 210px;" />
                </div>

                <div class="modal-input-group">
                  <input type="text" [(ngModel)]="row.remark"
                    class="row-input input-remark" style=" width: 210px;" />
                </div>

                <div class="modal-input-group">
                  <input type="date" [(ngModel)]="row.date"
                    class="row-input input-date" style=" width: 210px;" />
                </div>

                <button type="button"
                  (click)="removeRowAakArrived(i)">X</button>

              </div>
            </div>
          </div>

          <hr />

          <div class="combined-section"
            style="background-color: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);border: 1px solid #e0e0e0;">
            <!-- ================== SDT Arrived ================== -->
            <span>SDT status</span>
            <div class="modal-section">
              <!-- <h3>Number of container arrived sdt</h3> -->
              <div class="header-row">
                <label class="header-label"> number of container</label>
                <label class="header-label">Remark</label>
                <label class="header-label">Date</label>
                <div class="modal-buttons">
                  <button (click)="addRowSdtArrived()"
                    class="btn btn-success add-btn">
                    + add
                  </button>
                </div>
              </div>

              <!-- Dynamic rows -->
              <div *ngFor="let row of rowSdtArrived; let i = index"
                class="item-row">
                <div class="modal-input-group">
                  <input type="number" [(ngModel)]="row.numberOfContainer"
                    class="row-input input-number" style=" width: 210px;" />
                </div>

                <div class="modal-input-group">
                  <input type="text" [(ngModel)]="row.remark"
                    class="row-input input-remark" style=" width: 210px;" />
                </div>

                <div class="modal-input-group">
                  <input type="date" [(ngModel)]="row.date"
                    class="row-input input-date" style=" width: 210px;" />
                </div>

                <button type="button"
                  (click)="removeRowSdtArrived(i)">X</button>

              </div>
            </div>
          </div>

          <hr />

          <div class="combined-section"
            style="background-color: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);border: 1px solid #e0e0e0;">
            <!-- ================== Containers Returned ================== -->

            <span>Container Status</span>
            <div class="modal-section">
              <!-- Header row -->
              <!-- <h3>Number of empity container returned</h3> -->
              <div class="header-row">
                <label class="header-label">number of container</label>
                <label class="header-label">Remark</label>
                <label class="header-label">Date</label>
                <div class="modal-buttons">
                  <button (click)="addRowContainerReturned()"
                    class="btn btn-success add-btn">
                    + add
                  </button>
                </div>
              </div>

              <!-- Dynamic rows -->
              <div *ngFor="let row of rowsContainerReturned; let i = index"
                class="item-row">
                <div class="modal-input-group">
                  <input type="number" [(ngModel)]="row.numberOfContainer"
                    class="row-input input-number" style=" width: 210px;" />
                </div>

                <div class="modal-input-group">
                  <input type="text" [(ngModel)]="row.remark"
                    class="row-input input-remark" style=" width: 210px;" />
                </div>

                <div class="modal-input-group">
                  <input type="date" [(ngModel)]="row.date"
                    class="row-input input-date" style=" width: 210px;" />
                </div>

                <button type="button"
                  (click)="removeRowContainerReturned(i)">X</button>

              </div>
            </div>
          </div>

          <hr />

          <div class="combined-section"
            style="background-color: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);border: 1px solid #e0e0e0;">
            <div class="modal-form">
              <div class="modal-input-group full-width">

                <span>Remark</span>
                <textarea [(ngModel)]="editData.remark"></textarea>
              </div>
            </div>
          </div>

          <hr>

          <div class="modal-buttons">
            <button (click)="saveEditedLogisticsData()" class="btn btn-primary">
              Save Changes
            </button>
            <button (click)="closeModal()" class="btn btn-secondary">
              Cancel
            </button>
          </div>
        </ng-container>
      </ng-container>
      <!-- PAYMENT TAB -->
      <ng-container *ngIf="activeTab === 'payment' && buttonVisibility.payment">
        <ng-container *ngIf="pageType === 'intransit'">
          <div class="modal-header">
            <h3>Add Payment for {{ selectedRow?.transactionId }}</h3>
          </div>

          <div class="modal-buttons" style="margin-bottom: 10px">
            <button class="btn btn-success" (click)="addRow('payment')">
              + Add Payment
            </button>
          </div>

          <div
            *ngFor="let payment of newPayments; let j = index"
            class="payment-row"
            style="
              display: flex;
              gap: 10px;
              align-items: center;
              margin-bottom: 10px;
            ">
            <div class="modal-input-group" style="flex: 1">
              <label>Amount Paid:</label>
              <input type="number" [(ngModel)]="payment.amountPaid" required />
            </div>
            <div class="modal-input-group" style="flex: 1">
              <label>Paid By:</label>
              <input type="text" [(ngModel)]="payment.paidBy" required />
            </div>
            <div class="modal-input-group" style="flex: 1">
              <label>Account Paid From:</label>
              <input
                type="text"
                [(ngModel)]="payment.accountPaidFrom"
                required />
            </div>
            <div class="modal-input-group" style="flex: 1">
              <label>Payment Date:</label>
              <input type="date" [(ngModel)]="payment.paidDate" required />
            </div>
            <div class="modal-buttons">
              <button
                class="btn btn-danger"
                (click)="removeRow('payment', j)"
                [disabled]="j === 0">
                X
              </button>
            </div>
          </div>

          <div
            class="modal-buttons"
            style="margin-top: 10px; display: flex; gap: 10px">
            <button
              class="btn btn-primary"
              (click)="submitPayments(); closeModal()">
              Save
            </button>
            <button class="btn btn-secondary" (click)="closeModal()">
              Cancel
            </button>
          </div>
        </ng-container>
        <ng-container *ngIf="pageType === 'logistics'">
          <p>Logistics Payment Form goes here</p>
        </ng-container>
      </ng-container>

      <!-- DELETE TAB -->
      <ng-container *ngIf="activeTab === 'delete' && buttonVisibility.delete">
        <ng-container *ngIf="pageType === 'intransit'">
          <p>
            Are you sure you want to delete transaction:
            {{ selectedRow?.transactionId }}?
          </p>

          <div class="modal-buttons">
            <button
              class="btn btn-danger"
              (click)="confirmDeleteIntransitClick(); closeModal()">
              Delete
            </button>
            <button class="btn btn-secondary" (click)="closeModal()">
              Cancel
            </button>
          </div>
        </ng-container>
        <ng-container *ngIf="pageType === 'logistics'">
          <p>
            Are you sure you want to delete this Logistics transaction:
            {{ selectedRow?.transactionId }}?
          </p>

          <div class="modal-buttons">
            <button
              class="btn btn-danger"
              (click)="confirmDeleteLogisicsClick(); closeModal('main')">
              Delete
            </button>
            <button class="btn btn-secondary" (click)="closeModal('main')">
              Cancel
            </button>
          </div>
        </ng-container>
      </ng-container>
    </div>
  </div>
</div>
